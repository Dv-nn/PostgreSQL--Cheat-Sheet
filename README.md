# PostgreSQL Cheat-Sheet 

При инициализации  создаются три одинаковые базы данных:  
- `template0` используется для восстановления из логической резервной копии и никогда недолжна меняться  
- `template1` служит шаблоном для всех остальных баз данных, которые может создать пользователь в этом кластере  
- `postgres` представляет собой обычную базу данных, которую можно использовать по своему усмотрению
    
![](https://github.com/Dv-nn/PostgreSQL/blob/main/img/img.PNG)   

### Нормализация  
*Нормализация* это процесс приведения базы данных к нормальным формам с целью избавления от логической избыточности.    
### Транзакция  
*Транзакция* - это элементарная операция в базе данных. 
Транзакция может состоять и из нескольких операций: в этом ключе - это логически целостная процедура, в которой должны быть выполнены либо все операции - либо ни одна из них.  
Транзакция начинается с команды BEGIN и заканчивается командой COMMIT либо отменяется командой ROLLBACK. 

### Требования, предъявляемые к транзакции. ACID  
- Атомарность (atomicity). Это свойство означает, что либо транзакция будет зафиксирована в базе данных полностью, т. е. будут зафиксированы результаты выполнения всех ее операций, либо не будет зафиксирована ни одна операция транзакции.  
- Согласованность (consistency). Это свойство предписывает, чтобы в результате успешного выполнения транзакции база данных была переведена из одного согласованного состояния в другое согласованное состояние.  
- Изолированность (isolation). Во время выполнения транзакции другие транзакции должны оказывать по возможности минимальное влияние на нее.  
- Долговечность (durability). После успешной фиксации транзакции пользователь должен быть уверен, что данные надежно сохранены в базе данных и впоследствии могут быть извлечены из нее, независимо от последующих возможных сбоев в работе системы.

### Выполнение транзакций    
Можно выполнять транзакции последовательно или параллельно.  
При параллельных транзакций могут возникать "феномены":  
- Потерянное обновление (lost update)  
Когда разные транзакции одновременно изменяют одни и те же данные, то после фиксации изменений может оказаться, что одна транзакция перезаписала данные, обновленные и зафиксированные другой транзакцией.    
- «Грязное» чтение (dirty read)    
Транзакция читает данные, измененные параллельной транзакцией, которая еще не завершилась. Если эта параллельная транзакция в итоге будет отменена, тогда окажется, что первая транзакция прочитала данные, которых нет в системе.  
- Неповторяющееся чтение (non-repeatable read)    
При повторном чтении тех же самых данных в рамках одной транзакции оказывается, что другая транзакция успела изменить и зафиксировать эти данные. В результате тот же самый запрос выдает другой результат.  
- Фантомное чтение (phantom read)  
Транзакция повторно выбирает множество строк в соответствии с одним и тем же критерием. В интервале времени между выполнением этих выборок другая транзакция добавляет новые строки и успешно фиксирует изменения.  
В результате при выполнении повторной выборки в первой транзакции может быть получено другое множество строк.    
- Аномалия сериализации (serialization anomaly)  
Результат успешной фиксации группы транзакций, выполняющихся параллельно, не совпадает с результатом ни одного из возможных вариантов упорядочения этих транзакций, если бы они выполнялись последовательно.

### Аномалия сериализации  
Для двух транзакций, скажем, A и B, возможны только два варианта упорядочения при их последовательном выполнении:  
1 сначала A, затем B    
2️ сначала B, затем A    

Результаты реализации двух вариантов могут в общем случае не совпадать.   
Например, при выполнении двух банковских операций — внесения некоторой суммы денег на какой-то счет и начисления процентов по этому счету — важен порядок выполнения операций.      

Сериализация двух транзакций при их параллельном выполнении означает, что полученный результат будет соответствовать одному из двух возможных вариантов упорядочения транзакций при их последовательном выполнении.     
Конечно, чем больше транзакций, тем больше вариантов их упорядочения. Концепция сериализации не предписывает выбора какого-то определенного варианта.   

### Уровни изоляции в SQL    
- *Read Uncommitted*   
Это самый низкий уровень изоляции. Согласно стандарту SQL на этом уровне допускается чтение «грязных» (незафиксированных) данных.  
Однако в PostgreSQL требования, предъявляемые к этому уровню, более строгие, чем в стандарте: чтение «грязных» данных на этом уровне не допускается.  

- *Read Committed*  
Не допускается чтение «грязных» (незафиксированных) данных. Транзакция может видеть только те незафиксированные изменения данных, которые произведены в ходе выполнения ее самой.  

- *Repeatable Read*  
Не допускается чтение «грязных» (незафиксированных) данных и неповторяющееся чтение. В PostgreSQL на этом уровне не допускается также фантомное чтение.  

- *Serializable*  
Не допускается ни один из феноменов, перечисленных выше, в том числе и аномалии сериализации.  
Конкретный уровень изоляции обеспечивает сама СУБД с помощью своих внутренних механизмов. Его достаточно указать в команде при старте транзакции.
Однако программист может дополнительно использовать некоторые операторы и приемы программирования, например, устанавливать блокировки на уровне отдельных строк или всей таблицы.  
